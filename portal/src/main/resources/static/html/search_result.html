<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>搜索结果</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
<meta name="renderer" content="webkit">

<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
<meta name="renderer" content="webkit">
<meta name="baidu-site-verification" content="cSFG2PMaYX">
<meta name="applicable-device" content="pc,mobile">

<link rel = "stylesheet" href = "../css/bootstrap/bootstrap.min.css"/>
<link rel = "stylesheet" href = "../css/pagination/pagination.css"/>
<link rel = "stylesheet" href = "../css/jquery-ui/jquery-ui.css"/>
<script src = "../js/jquery/jquery-1.8.3.min.js"></script>
<script src = "../js/pagination/pagination.min.js"></script>
<script src = "../js/jquery-ui/jquery-ui.js"></script>
<style>
	body{
		margin:0px;
		min-width: 800px;
	}
	.head{
		height:80px;
		box-shadow: 0 0 10px #E5E6E9;
		border-bottom:solid 1px #eee
	}
	.img{
		height:70px;
		width:300px;
		margin-top:5px;
	}
	.menu{
		display:flex;
		width:15%;
		height:100%;
		font-size:18px;
		font-family:Microsoft YaHei;
		align-items:center;
		float:right;
		line-height:79px;
	}
	a{
		color:black;
	}
	a:hover{
		text-decoration:none;
	}
	.title{
		text-align:center;
		font-size:60px;
		margin-top:15%;
		font-family:Microsoft YaHei;
		color: rgb(78, 80, 81)
	}
	.searchbtn{
		width:100px;
	    height: 50px;
	    font-size: 18px;
	    line-height: 50px;
	    text-align: center;
	    font-family: 幼圆;
	    background-color: #24C0D7;
	    color: white;
	    border:none;
		vertical-align: top;
	    border-radius: 0px 5px 5px 0px;
	}
	.searchbtn:hover{
		background-color:#2691a0;
	}
	.context{
		margin-top:1%;
		font-size:20px;
		font-family:黑体;
		background-color:#e4e8e8;
		min-height:830px;
	}
	.order{
		color: #35C5DA;
	    font-weight: bold;
	    margin: 0px 10px;
	    float: left;
	    display: inline-block;
	    width: 18px;
	    text-align: right;
	}
	.resultDiv{
		height:100px;
		font-size:18px;
		border-bottom:1px solid rgb(221, 221, 221);
		padding:15px 0px;
		display:flex;
		align-items:center;
		margin:0!important;
	}
	li:hover{
		background:#eee;
	}
	.l-on{
		background:#eee;
	}
</style>
</head>
<body>
	<div class = "head" >
		<div style = "width:38%;float:right;margin-right:12%;">
			<div class = "menu"><a style = "min-width: 80px;" href ="/html/search_result.html">搜索服务</a></div>
			<div class = "menu"><a href ="/ioss">首页</a></div>
		</div>
		<div style = "width:38%;float:left;margin-left:12%;">
			<img class = "img" src = "../img/gd_rant.png"/>
		</div>
	</div>
	<div style = "padding: 25px 0px; height:110px;text-align: center; background-color: #F6F5FB;position:relative">
			<input id = "content" style = "width:30%;height:50px;padding-left:10px;line-height:50px;font-size:18px;float:left;margin-left:30%" type = "text" placeholder="请输入您要查询的信息">
			<button id = "searchbtn" class = "searchbtn" style="width:10%;float:left">搜索</button>
			<div id = "tips" style = "width:30%;position:absolute;z-index:100;left:30%;top:75px"></div>
	</div>
	<div style = "background-color:#fff;padding-top: 20px;">
		<div style = "width:80%;float:left;margin-left:10%">
			<div>
			<div>
				<img src="../img/dygjc.png" style = "height:22px;margin:2px 10px 0px 5px;float:left;">
				<div style = "height:35px;margin:10px 5px;font-family:宋体;border-bottom:1px solid gray;font-size:16px">搜索结果</div>
			</div>
			</div>
			<div id = "searchresult"></div>
			
			<div id = "pagination" style = "margin-top:5%;margin-bottom:10%;margin-left:28%;"></div>
		</div>
	</div>
	<script>
	function parseHtml(data){
		var htmlstr = "";
		for(var i in data){
			var eventId = data[i]["eventId"];
			var title = data[i]["title"];
			var description = data[i]["description"];
			var commitTime = data[i]["commitTime"];
			if(typeof commitTime == 'undefined'){
				commitTime = '';
			}
			htmlstr += 
				'<div class = "row resultDiv">'+
					'<div class = "col-xs-9" style="height:90px;line-height:90px; padding:0"><a href = "ticket_detail.html?id='+eventId+'"  target="_blank">'+title+'</a></div>'+
					'<div class = "col-xs-3" style = "height:90px;position:relative; padding:0"><span style = "border:1px solid #24C0D7;border-radius:5px;padding:1px 5px;float:right;position:absolute;right:0px;top:15px">'+commitTime.substr(0,10)+
					'</span><a href = "ticket_detail.html" style = "color:#008000;position:absolute;top:47px;left:28px;">ITSM</a><span style = "background:#24C0D7;border-radios:5px;border-radius:5px;padding:1px 5px;position:absolute;top:47px;right:0px;">'+commitTime.substr(0,10)+'</span>'+
					'<span style="position:absolute; right:120px;top:20px;font-size:14px">提交时间</span><span style="position:absolute; right:120px;top:50px;font-size:14px">解决时间</span></div>'+
				'</div>';
		}
		return htmlstr;
	}
	
	$(function(){
		var thisURL = decodeURI(document.URL); 
		var  param =thisURL.split('?')[1]; 
		if(undefined != param){
			var paramVal= param.split("=")[1];
			
			$('#content').val(paramVal);
			
			if("" != paramVal){
				$.ajax({
					url:'/ioss/knowledge/queryer?queryParams='+paramVal,
					type:'get',
					datatype:'json',
					success:function(data){
					var jsonData = JSON.parse(data);
					if("" != jsonData)
					$('#pagination').pagination({
						dataSource:jsonData ,
						pageNumber: 1,
						pageSize: 10,
						pageRange: 2,
						showGoInput: true,
						showGoButton: true,
					    className: 'paginationjs-theme-blue paginationjs-big',
					    totalNumber: jsonData.length,
					    callback: function(data, pagination) {
					        var html = parseHtml(data);
					        $('#searchresult').html(html);
					        $('#pagination').show();
					    }
					});
					else {
						$('#pagination').hide();
						$('#searchresult').html('<h4 style = "font-family:黑体;margin-bottom:100px;margin-top:25px;">抱歉，没有相关内容...</h4>');
					}
				}
				});
			}
		}
	});
	
	document.onkeydown=function(event){
	    var e = event || window.event || arguments.callee.caller.arguments[0];
	    
	    if(e && e.keyCode==13){ // enter 键
	         //要做的事情
	    	$('#searchbtn').click();
	    }
	}; 
	
	$('#searchbtn').click(function(){
		var content = $('#content').val();
		var url = encodeURI("search_result.html?content="+content);

		 location.replace(url);
	});
	
	//输入框联想搜索
	$('#content').focus(function(){
		var curIndex = -1;
		$('#content').keydown(function(event){
			
			$('#content').bind('input propertychange', function() {
				//todo 补充监听300ms的操作
				 $.ajax({
			          url: '/ioss/knowledge/queryhotwords?keyword='+$(this).val(),
			          type:'GET',
			          dataType: "json",
			          success: function( data ) {
			        	  //todo 判断数据的合法性
			              setDom(data.data);
			          }
			        });
				});
			function setDom(data){
				var obj = $('#tips'),str='<div style="border:0.5px solid gainsboro;background:#fff;"><ul id="ul-list" style = "margin-bottom:0px;font-size:18px;line-height:2em;padding:0">';
				obj.html('');
				for(var i=0;i<data.length;i++){
					str+='<a href = "javascript:void(0)"><li style="list-style-type:none;padding-left:10px;text-align:left">'+data[i]+'</li></a>';
				}
				str+='</ul></div>'
				obj.html(str);
				curIndex =-1;
				
				
				
				//点击选择联想热词
				obj.find('li').unbind();
				obj.find('li').on('click',function(){
					var regexstr = new RegExp("<[^<]*>", "gi");
					var content = $(this).html().replace(regexstr,"");
					$('#content').val(content);
					obj.html('');
				})
				//input元素失去焦点事件发生时，清空list元素
				$('#content').blur(function(){
					var obj = $('#tips');
					setTimeout(function(){
						//obj.html('');
					},300)
				});
			}
			
			switch(event.which){
				case 38:
				pickVal(38);
				break;
			
			　　case 40: 
				pickVal(40);
				break;
				
			　　default: break; 
			}
			
			function pickVal(type){
				
				var obj = $('#tips ul li');
				var length = obj.length;
				if(length){
					obj.removeClass('l-on');
					if(type>39){
						if(curIndex<0||curIndex==length-1){
							curIndex=0;
						}else{
							curIndex++;
						}
						var html = $("ul li").eq(curIndex).html()
						var regexstr = new RegExp("<[^<]*>", "gi");
						var html = html.replace(regexstr,"");
						$("#content").val(html); 
						obj.eq(curIndex).addClass('l-on');
					}else{
						if(curIndex<=0||curIndex>=length){
							curIndex=length-1;
							
						}else{
							curIndex--;
						}
						var html = $("ul li").eq(curIndex).html();
						var regexstr = new RegExp("<[^<]*>", "gi");
						var html = html.replace(regexstr,"");
						$("#content").val(html); 
						obj.eq(curIndex).addClass('l-on');
					}
				}
			}
		});
	});
	
	</script>
</body>
</html>