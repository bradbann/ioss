<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>搜索结果</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
<meta name="renderer" content="webkit">

<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
<meta name="renderer" content="webkit">
<meta name="baidu-site-verification" content="cSFG2PMaYX">
<meta name="applicable-device" content="pc,mobile">

<link rel = "stylesheet" href = "../css/bootstrap/bootstrap.min.css"/>
<link rel = "stylesheet" href = "../css/pagination/pagination.css"/>
<link rel = "stylesheet" href = "../css/jquery-ui/jquery-ui.css"/>
<script src = "../js/jquery/jquery-1.11.1.min.js"></script>
<script src = "../js/jquery/jquery-3.0.0.js"></script>
<script src = "../js/pagination/pagination.min.js"></script>
<script src = "../js/jquery-ui/jquery-ui.js"></script>
<style>
	body{
		margin:0px;
	}
	.head{
		height:10%;
		box-shadow: 0 0 10px #E5E6E9;
	}
	.img{
		height:95%;
		margin-top:3px;
	}
	.menu{
		display:flex;
		width:15%;
		height:100%;
		font-size:18px;
		font-family:Microsoft YaHei;
		align-items:center;
		float:right;
	}
	a{
		color:black;
	}
	a:hover{
		text-decoration:none;
	}
	.title{
		text-align:center;
		font-size:60px;
		margin-top:15%;
		font-family:Microsoft YaHei;
		color: rgb(78, 80, 81)
	}
	.searchbtn{
		width: 13%;
	    height: 40px;
	    margin-left:-4px;
	    font-size: 22px;
	    text-align: center;
	    font-family: 幼圆;
	    background-color: #24C0D7;
	    color: white;
	    border:none;
	    vertical-align: top;
	}
	.searchbtn:hover{
	    background-color:#2691a0;
	}
	.context{
		margin-top:1%;
		font-size:20px;
		font-family:黑体;
		background-color:#e4e8e8;
		min-height:830px;
	}
	.order{
		color: #35C5DA;
	    font-weight: bold;
	    margin: 0px 10px;
	    float: left;
	    display: inline-block;
	    width: 18px;
	    text-align: right;
	}
	.resultDiv{
		height:70px;
		width:90%;
		font-size:18px;
		border-bottom:1px solid rgb(221, 221, 221);
		padding:15px 0px;
		display:flex;
		align-items:center;
		margin-left:5%;
	}
	li:hover{
		background:#eee;
	}
	.l-on{
		background:#eee;
	}
</style>
</head>
<body>
	<div class = "head" >
		<div style = "width:40%;float:right;margin-right:12%;">
			<div class = "menu"><a href = "apiInterface.html">API接口</a></div>
			<div class = "menu"><a>搜索服务</a></div>
			<div class = "menu"><a>知识库管理</a></div>
			<div class = "menu"><a href = "home.html">首页</a></div>
		</div>
		<div style = "width:30%;float:right;margin-top:2%;margin-right:-13%;">
			<div style="position:relative">
			<input id = "content" style = "width:80%;height:40px;padding-left:10px;font-size:16px;" type = "text" placeholder="请输入您要查询的信息">
			<button id = "searchbtn" class = "searchbtn">搜索</button>
			<div id = "tips" style = "width:100%;position:absolute;z-index:100;"></div>
			</div>
			
			
		</div>
		<div>
			<img class = "img" src = "../img/gd_rant.png"/>
		</div>
	</div>
	<div style = "background-color:#f3f3f3;">
	<div class = "container" style = "margin-top:1%;font-size:20px;font-family:黑体;background-color:white;min-height:830px;">
		<div style = "background-color:#f3f3f3;">
			<div style = "border-bottom:1px solid rgb(221, 221, 221);width:90%;margin-left:5%;background-color:#f3f3f3">
		</div>
			<div style = "margin:10px 5px;font-family:宋体;">搜索结果...</div>
		</div>
		<div id = "searchresult">
			<div class = "row resultDiv">
<!-- 			    <div class = "col-xs-10"> -->
<!-- 			        <h4>因医生误诊，英国一女童7年没用嘴吃过东西。</h4> -->
<!-- 			        <h5>破茧成蝶——从准新闻人到新闻人的过渡所必备的素质 ——分类新闻写作课学期总结</h5> -->
<!-- 			        <h5>解决方案，已解决；解决方案，已解决；解决方案，已解决；解决方案，已解决；解决方案，已解决；</h5> -->
<!-- 			        <div class = row> -->
<!-- 			            <span>2015-07-13</span> -->
<!-- 			            <span><a href = "ticket_detail.html">地税API</a></span> -->
<!-- 			        </div> -->
<!-- 			    </div> -->
<!-- 			    <div class = "col-xs-2"></div> -->
			</div>
		</div>
		
		<div id = "pagination" style = "margin-top:5%;margin-bottom:10%;margin-left:28%;"></div>
	</div>
	</div>
	<script>
	function parseHtml(data){
		var htmlstr = "";
		for(var i in data){
			var title = data[i]["title"];
			var description = data[i]["description"];
			var commitTime = data[i]["commitTime"];
			htmlstr += 
				'<div class = "row resultDiv">'+
					'<div class = "col-xs-10"><a>'+title+'</a></div>'+
					'<div class = "col-xs-2"><span style = "float:right;">'+commitTime.substr(0,10)+'</span></div>'+
				'</div>';
		}
		return htmlstr;
	}
	
	$(function(){
		var thisURL = decodeURI(document.URL); 
		var  param =thisURL.split('?')[1]; 
		if(undefined != param){
			var paramVal= param.split("=")[1];
			
			$('#content').val(paramVal);
			
			if("" != paramVal){
				$.ajax({
					url:'/ioss/knowledge/queryer?queryParams='+paramVal,
					type:'get',
					datatype:'json',
					success:function(data){
					var jsonData = JSON.parse(data);
					if("" != jsonData)
					$('#pagination').pagination({
						dataSource:jsonData ,
						pageNumber: 1,
						pageSize: 10,
						pageRange: 2,
						showGoInput: true,
						showGoButton: true,
					    className: 'paginationjs-theme-blue paginationjs-big',
					    totalNumber: jsonData.length,
					    callback: function(data, pagination) {
					        var html = parseHtml(data);
					        $('#searchresult').html(html);
					        $('#pagination').show();
					    }
					});
					else {
						$('#pagination').hide();
						$('#searchresult').html('<h4 style = "font-family:黑体;margin-bottom:100px;margin-top:25px;">抱歉，没有相关内容...</h4>');
					}
				}
				});
			}
		}
	});
	
	document.onkeydown=function(event){
	    var e = event || window.event || arguments.callee.caller.arguments[0];
	    
	    if(e && e.keyCode==13){ // enter 键
	         //要做的事情
	    	$('#searchbtn').click();
	    }
	}; 
	
	$('#searchbtn').click(function(){
		var content = $('#content').val();
		var url = encodeURI("search_result.html?content="+content);

		 location.replace(url);
	});
	
	//输入框联想搜索
	$('#content').focus(function(){
		var curIndex = -1;
		$('#content').keydown(function(event){
			console.log("输入框按键事件触发！");
			
			$('#content').bind('input propertychange', function() {
				//todo 补充监听300ms的操作
				 console.log($(this).val());
				 $.ajax({
			          url: '/ioss/knowledge/queryhotwords?keyword='+$(this).val(),
			          type:'GET',
			          dataType: "json",
			          success: function( data ) {
			        	  //todo 判断数据的合法性
			        	  console.log(data);
			              setDom(data.data);
			          }
			        });
				});
			function setDom(data){
				var obj = $('#tips'),str='<div style="width:80%;display:inline-block;border:0.5px solid gainsboro;background:#fff;"><ul id="ul-list" style = "margin-bottom:0px;font-size:18px;line-height:2em;margin-left:-9%;">';
				obj.html('');
				for(var i=0;i<data.length;i++){
					str+='<a href = "javascript:void(0)"><li style="list-style-type:none;padding-left:10px;">'+data[i]+'</li></a>';
				}
				str+='</ul></div>'
				obj.html(str);
				curIndex =-1;
				
				
				
				//点击选择联想热词
				obj.find('li').unbind();
				obj.find('li').on('click',function(){
					console.log($(this).html());
					var regexstr = new RegExp("<[^<]*>", "gi");
					var content = $(this).html().replace(regexstr,"");
					$('#content').val(content);
					obj.html('');
				})
				//input元素失去焦点事件发生时，清空list元素
				$('#content').blur(function(){
					var obj = $('#tips');
					setTimeout(function(){
						obj.html('');
					},300)
				});
				console.log('ADD')
			}
			
			switch(event.which){
				case 38:
				console.log('38');
				pickVal(38);
				break;
			
			　　case 40: 
				pickVal(40);
				console.log('40');
				break;
				
			　　default: break; 
			}
			
			function pickVal(type){
				
				var obj = $('#tips ul li');
				var length = obj.length;
				console.log(length);
				if(length){
					obj.removeClass('l-on');
					if(type>39){
						if(curIndex<0||curIndex==length-1){
							curIndex=0;
						}else{
							curIndex++;
						}
						console.log('给第'+curIndex+'个li添加样式');
						var html = $("ul li").eq(curIndex).html()
						var regexstr = new RegExp("<[^<]*>", "gi");
						var html = html.replace(regexstr,"");
						$("#content").val(html); 
						obj.eq(curIndex).addClass('l-on');
					}else{
						console.log('U');
						if(curIndex<=0||curIndex>=length){
							curIndex=length-1;
							
						}else{
							curIndex--;
						}
						console.log('给第'+curIndex+'个li添加样式');
						var html = $("ul li").eq(curIndex).html();
						var regexstr = new RegExp("<[^<]*>", "gi");
						var html = html.replace(regexstr,"");
						$("#content").val(html); 
						obj.eq(curIndex).addClass('l-on');
					}
				}
			}
		});
	});
	
	</script>
</body>
</html>